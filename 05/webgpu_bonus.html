<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WebGPU Rendering</title>
    <style>
      html,
      body {
        background-color: black;
        margin: 0;
        padding: 0;
        height: 100%;
        overflow: hidden;
      }

      /* Force canvas to be full size of viewport */
      #canvas {
        width: 100vw;
        height: 100vh;
      }
    </style>
    <script src="https://cdn.babylonjs.com/babylon.js"></script>
    <script src="https://cdn.babylonjs.com/loaders/babylon.glTF2FileLoader.min.js"></script>

    <script>
      window.onload = async () => {
        let canvas = document.getElementById("canvas"); // Pointer to canvas element

        // Initialize Engine
        let engine = new BABYLON.WebGPUEngine(canvas, { antialiasing: true });
        await engine.initAsync();

        // Initialize Scene
        const scene = new BABYLON.Scene(engine);
        
        // Load model
        await BABYLON.SceneLoader.AppendAsync("", "UneditedAppa.glb", scene);

        // Example code used for setting up pbr: https://forum.babylonjs.com/t/how-to-use-pbr-material/9346/10

        // .env file used was found through babylon.js docs: https://github.com/BabylonJS/Documentation/blob/master/content/toolsAndResources/assetLibraries/availableTextures.md#hdr-as-env
        const envTexture = BABYLON.CubeTexture.CreateFromPrefilteredData(
          "https://playground.babylonjs.com/textures/parking.env",
          scene
        );

        // Environment texture used for reflection on PBR.
        scene.environmentTexture = envTexture;

        const pbr = new BABYLON.PBRMaterial();
        
        // This creates a reflective metal surface like a mirror. The scene in the reflection is a parking lot which can be seen here: https://playground.babylonjs.com/#CGA05F#42
        pbr.metallic = 1; 
        pbr.roughness = 0; 

        // Reset rotation of the model in the scene.
        scene.meshes.forEach((mesh) => {
          mesh.rotation = BABYLON.Vector3.Zero();
          mesh.material = pbr;
        });

        // Enable default camera and light
        scene.createDefaultCameraOrLight(true, true, true);
        scene.activeCamera.attachControl(canvas, true);

        engine.runRenderLoop(() => scene.render());
        addEventListener("resize", () => engine.resize());
      };
    </script>
  </head>
  <body>
    <canvas id="canvas"></canvas>
  </body>
</html>
